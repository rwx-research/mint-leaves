- key: github-cli
  call: github/install-cli 1.0.1

- key: test-one-pattern-has-changes
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: 5294685f36ff0edd7775f685a1e92728d7f223cf
    head-ref: 8fe238bebb9276a7fafb83c7ee0513c83fa89061
    github-token: ${{ github.token }}
    patterns: "**/*.go"

- key: assert-one-pattern-has-changes
  run: '[ "${{ tasks.test-one-pattern-has-changes.values.has-changes }}" == "true" ]'

- key: test-multiple-patterns-have-changes
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: 5294685f36ff0edd7775f685a1e92728d7f223cf
    head-ref: 8fe238bebb9276a7fafb83c7ee0513c83fa89061
    github-token: ${{ github.token }}
    patterns: |
      **/*.go
      **/*.txt

- key: assert-multiple-patterns-have-changes
  run: '[ "${{ tasks.test-multiple-patterns-have-changes.values.have-changes }}" == "true" ]'

- key: test-negations-have-changes
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: 5294685f36ff0edd7775f685a1e92728d7f223cf
    head-ref: 8fe238bebb9276a7fafb83c7ee0513c83fa89061
    github-token: ${{ github.token }}
    patterns: |
      !**/*.go
      internal/cli/parse.go

- key: assert-negations-have-changes
  run: '[ "${{ tasks.test-negations-have-changes.values.have-changes }}" == "true" ]'

- key: test-one-pattern-has-no-changes
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: 5294685f36ff0edd7775f685a1e92728d7f223cf
    head-ref: 8fe238bebb9276a7fafb83c7ee0513c83fa89061
    github-token: ${{ github.token }}
    patterns: "**/*.rb"

- key: assert-one-pattern-has-no-changes
  run: '[ "${{ tasks.test-one-pattern-has-no-changes.values.has-changes }}" == "false" ]'

- key: test-multiple-patterns-have-no-changes
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: 5294685f36ff0edd7775f685a1e92728d7f223cf
    head-ref: 8fe238bebb9276a7fafb83c7ee0513c83fa89061
    github-token: ${{ github.token }}
    patterns: |
      **/*.rb
      Gemfile.lock

- key: assert-multiple-patterns-have-no-changes
  run: '[ "${{ tasks.test-multiple-patterns-have-no-changes.values.have-changes }}" == "false" ]'

- key: test-negations-have-no-changes
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: 5294685f36ff0edd7775f685a1e92728d7f223cf
    head-ref: 8fe238bebb9276a7fafb83c7ee0513c83fa89061
    github-token: ${{ github.token }}
    patterns: |
      internal/cli/parse.go
      !**/*.go

- key: assert-negations-have-no-changes
  run: '[ "${{ tasks.test-negations-have-no-changes.values.have-changes }}" == "false" ]'

- key: test-resolves-ref-names
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: main
    head-ref: main
    github-token: ${{ github.token }}
    patterns: "**/*"

- key: assert-resolves-ref-names
  run: '[ "${{ tasks.test-resolves-ref-names.values.has-changes }}" == "false" ]'

- key: test-resolves-refs-with-prefixes
  use: github-cli
  call: $LEAF_DIGEST
  with:
    repository: rwx-research/captain
    base-ref: refs/heads/main
    head-ref: refs/heads/main
    github-token: ${{ github.token }}
    patterns: "**/*"

- key: assert-resolves-refs-with-prefixes
  run: '[ "${{ tasks.test-resolves-refs-with-prefixes.values.has-changes }}" == "false" ]'
